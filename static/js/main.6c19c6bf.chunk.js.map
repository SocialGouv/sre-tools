{"version":3,"sources":["App.js","certificates.js","Form.js","useQueryParams.js","index.js"],"names":["dotenv","config","multiline","debug","path","Intro","style","padding","CodeArea","props","fontSize","fontFamily","border","width","height","Copier","text","useState","copied","setCopied","onCopy","setTimeout","marginLeft","cursor","transition","color","title","size","parseClearText","values","match","parse","Buffer","from","VALUE","Editor","cluster","value","namespace","name","formData","setFormData","encrypted","setEncrypted","yamlResult","setYamlResult","onSubmit","data","a","pemKey","certificates","getSealedSecret","scope","sealedSecret","keys","Object","length","spec","encryptedData","yaml","dump","noRefs","lineWidth","console","log","xs","initialFormData","marginTop","Body","Title","defaultValue","App","className","dev","prod","keyValidator","RadioChoice","React","forwardRef","ref","Check","inline","id","label","type","keepValidQueryParamKeys","key","includes","object","filter","reduce","acc","Form","urlParams","window","location","search","innerData","setInnerData","useCallback","history","replaceState","document","href","split","stringify","useQueryParams","queryParamsData","setQueryParamsData","queryParams","defaultValues","useForm","mode","register","handleSubmit","watch","setValue","trigger","getValues","_onSubmit","useEffect","subscription","unsubscribe","Row","Col","md","sm","Label","onChange","e","target","undefined","display","disabled","Group","as","column","Control","required","placeholder","rows","rootElement","getElementById","ReactDOM","render"],"mappings":"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","file":"static/js/main.6c19c6bf.chunk.js","sourcesContent":["import React, { useState } from \"react\";\nimport { Card, Jumbotron, Container, Row, Col } from \"react-bootstrap\";\nimport { getSealedSecret } from \"@socialgouv/aes-gcm-rsa-oaep\";\nimport { CopyToClipboard } from \"react-copy-to-clipboard\";\nimport { Clipboard } from \"react-feather\";\nimport yaml from \"js-yaml\";\n\nimport dotenv from \"dotenv\";\n\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nimport { Form } from \"./Form\";\nimport { certificates } from \"./certificates.js\";\n\ndotenv.config({ multiline: true, debug: true, path: false });\n\nconst Intro = () => (\n  <Jumbotron style={{ padding: \"2rem 1rem\" }}>\n    <h1>WebSeal</h1>\n    <p>Client-side sealed-secrets generation</p>\n  </Jumbotron>\n);\n\nconst CodeArea = (props) => (\n  <textarea\n    {...props}\n    style={{\n      fontSize: \"0.8rem\",\n      fontFamily: \"Courier\",\n      border: \"1px solid #ccc\",\n      width: \"100%\",\n      padding: 5,\n      height: 400,\n      ...(props.style || {}),\n    }}\n  ></textarea>\n);\n\nconst Copier = ({ text }) => {\n  const [copied, setCopied] = useState(false);\n  return (\n    <CopyToClipboard\n      text={text}\n      onCopy={() => {\n        setCopied(true);\n        setTimeout(() => setCopied(false), 2000);\n      }}\n    >\n      <Clipboard\n        style={{\n          marginLeft: 10,\n          cursor: \"pointer\",\n          transition: \"all 0.2s ease-in\",\n        }}\n        color={copied ? \"green\" : \"black\"}\n        title=\"Copy\"\n        size={16}\n      />\n    </CopyToClipboard>\n  );\n};\n\nexport const parseClearText = (text) => {\n  let values = {};\n  if (text.match(/^([\\w_-\\d]+)=(.+)$/im)) {\n    values = dotenv.parse(Buffer.from(text));\n  } else {\n    values.VALUE = text;\n  }\n  return values;\n};\n\nconst Editor = () => {\n  const [formData, setFormData] = useState({\n    cluster: \"dev\",\n    value: \"\",\n    namespace: \"\",\n    name: \"\",\n  });\n  const [encrypted, setEncrypted] = useState(null);\n  const [yamlResult, setYamlResult] = useState(null);\n  const onSubmit = async (data) => {\n    //console.log(\"onSubmit\", data);\n    setFormData(data);\n    setYamlResult(\"\");\n    setEncrypted(\"\");\n\n    if (data.value && data.value !== formData.value) {\n      const pemKey = certificates[data.cluster];\n      const values = parseClearText(data.value);\n      const sealedSecret = await getSealedSecret({\n        pemKey,\n        namespace: data.namespace || null,\n        name: data.name || \"some-secret-name\",\n        scope: data.scope,\n        values,\n      });\n      if (data.scope === \"strict\" && (!data.namespace || !data.name)) {\n        console.log(\"namespace and name are mandatory\");\n        setYamlResult(\"\");\n        setEncrypted(\"\");\n      } else if (!data.value) {\n        console.log(\"value is mandatory\");\n        setYamlResult(\"\");\n        setEncrypted(\"\");\n      } else {\n        const keys = Object.keys(values);\n        if (keys.length === 1) {\n          setEncrypted(sealedSecret.spec.encryptedData[keys[0]]);\n        } else {\n          setEncrypted(\n            \"Not available for multiple values, use the below secret\"\n          );\n        }\n        setYamlResult(yaml.dump(sealedSecret, { noRefs: true, lineWidth: -1 }));\n      }\n    }\n  };\n  return (\n    <Container>\n      <Intro />\n      <Row>\n        <Col xs={12}>\n          <Form onSubmit={onSubmit} initialFormData={formData} />\n\n          {\n            <>\n              <Card style={{ marginTop: 10 }}>\n                <Card.Body>\n                  <Card.Title>\n                    Encrypted <Copier text={encrypted} />\n                  </Card.Title>\n                  <CodeArea defaultValue={encrypted} style={{ height: 200 }} />\n                </Card.Body>\n              </Card>\n              <Card style={{ marginTop: 10 }}>\n                <Card.Body>\n                  <Card.Title>\n                    SealedSecret <Copier text={yamlResult} />\n                  </Card.Title>\n                  <CodeArea defaultValue={yamlResult} />\n                </Card.Body>\n              </Card>\n            </>\n          }\n        </Col>\n      </Row>\n    </Container>\n  );\n};\n\nexport default function App() {\n  return (\n    <div className=\"App\">\n      <Editor />\n    </div>\n  );\n}\n","\n// https://kubeseal.dev2.fabrique.social.gouv.fr/v1/cert.pem\nexport const dev = `-----BEGIN CERTIFICATE-----\nMIIErjCCApagAwIBAgIRAOqAV9ZpCl1cwMunTHirqXwwDQYJKoZIhvcNAQELBQAw\nADAeFw0yMDA1MjYwODQxMTBaFw0zMDA1MjQwODQxMTBaMAAwggIiMA0GCSqGSIb3\nDQEBAQUAA4ICDwAwggIKAoICAQDc5wz/el5+ghmNAsQzpFK3jtLRIDcoYgyeGHaG\nLH/FCuatiE3qhFeJt2uYQ+GFmEg3e9N/6xDY8NgUMvLdUlAfl5TqV5H96EXTSsGE\naRL2K4EIIdmFflas+r7dh5IYtmV8NTXW2ESLkyOe3PufK/OhdD/xcxglYLM+JnR2\npbKqFvFcsk+LHK3FTWt0xSeqgd+6G9PIxUAbHtoKYI9R41rWnCXY7n0zp+zWD/6j\nEDsbCgFJ657Zwwn0XXGkQqItdZsN+ETIcBVIdqemzcksd7RRUZQiJF8imM5S/wj/\n1o55JwAPLqg5Odj5T/pQq4gSG+UG1P0eJxBQpUCgmtW1SAjS2Gv9kkuw/PAMmLAa\nN0uHnM8TY9OPLLMENjmn9IhvYrhj5lKff4NXNC4nHFSDUAVfu5kNHrYn9WnCCw/f\nZE81p5Do7IcsbfmgEq3Ttg7p1eqXpH9NE9TWSZTz3HW/0lmEuIsNxjX/692DBeP/\nCCUiYlAef704Woo84jwIz4jEwfjonsFVaHbbtIGyqjvTlWcYfQnCLvnB+Plqutc/\n/p8/ViXXfuAwj/K3lYvhGWt2TNLo963XG/pqBVbZxYVI4m7IzrZ0vhbhck1oGYN8\nyX8sYPBUn5/5X/bJ8Xz1KsAeCfSXAvCjAZ3MfQDwxbsEURVQAeiDcF61G75/Lq/Z\nBm74hwIDAQABoyMwITAOBgNVHQ8BAf8EBAMCAAEwDwYDVR0TAQH/BAUwAwEB/zAN\nBgkqhkiG9w0BAQsFAAOCAgEAKLvQtDV5QVNUEcg3ywL03IwtNWmU8EqqASgckVAc\ndmeGnFwV7+7VnrIHI34xCZDhAVEnlMAb0oELgTDSstTx4p25rjqOLQfPcb0TsPko\ncpJHS00trLsLX4DYoZ1dLprgySGrC9jQ/FMYMK1oZ0M04gA/U9alNVNu2DWKosHu\nJGRYBbXVnse5rZi3hl4GV5Vq2ZR/3GHL9xgcjMcSLqHhXoSULLm5qEBUA5flV0BJ\nbY2FEfpm1NHSh5vOaA5t7lrW/XqiAuo8lJM2Ztg/dsX6Zxq7Memq8nqMRpoMFbdj\ni0jTxlPL1ssVHvvmWcLsdx9fHX7XaNGZ4ulA6BIL4DZQMPxvtFk9alqbc9WnjsqL\n/8QA3STXkTSzWrSsTUcabxlp5+MLHRf31iE1dlGVv7FVLjPy29T145eSzoNPM9sN\n1+aBLnXDCj5HUwto8+iKJn7VTURty5KceUFSeURXM2IKYYTec8MElLX0PeXi+SvO\nW37ZCn0RMnljus5aTUPbRHNvJ3Ut/1WDLQu8X0wIm509F1A80Udg5FTxHasBizM2\nL+rpr2923MG1JSitDfvNj1rxx1FLdynP84SOEJDCtbB8YRcDUC4bHKrAcG4FBAFX\nUDzbbsoR58onjcZW3QH4mvV9K3+llwHSo8zfYyKRhF8pUUJHp7A/8DgMYQyYAv2z\nbag=\n-----END CERTIFICATE-----`;\n\n// https://kubeseal.prod2.fabrique.social.gouv.fr/v1/cert.pem\nexport const prod = `-----BEGIN CERTIFICATE-----\nMIIErTCCApWgAwIBAgIQXJCfJIfF/fpww3KcvD0j1TANBgkqhkiG9w0BAQsFADAA\nMB4XDTIwMDUyNjA4NDkyN1oXDTMwMDUyNDA4NDkyN1owADCCAiIwDQYJKoZIhvcN\nAQEBBQADggIPADCCAgoCggIBAK8tTm78wfObpDaAa00eli9TwZfjbSO+Bis6DqNX\nto+tddnEBuEmnOlTKKoODZwnuph/G8JELKwbaTJ1bdYKasKDdgYju52ZMjBNexs4\nOX1L+YLiJEkwYBSkmYR/ARAulXIAolozjvub888OdWWOuZfX3DeNh/AI24uc+nrw\nsiKMyRZSsW9OXhRpBFe1BY8xofvnf1Ts5+OZWeNEmTbAKROKDd3rJpaKzxsJJwQ+\nSmRUQnxmwNxOfjFFxJx6n1jRloqwpLTOkCX/iSp6Nhnprcs8dvFjSH7l+gQU8XVY\nVXRWfXdJ6hBZd6fOjhKxlIrPz5+mUsMhyzON3ZS83XG9imFrWgSh3nBCifZRs4YF\nwxtGL1Qwm6CM+OsjLHM4lo6hrh9eEZVO8TwrXWKDU1CKkBgXVA5irGJ7NbGKtzih\nBZMRZ5pqQQ6ptiLXxfiB6DgvIJqvL8+yrt22j/QFZtyKkVW02n+dNiI7ltxb9RdS\nhyv3wBbHORgw6DbPrpoRpabDfUDEGJnd7+gY0Z5P9wHeX1vtt4g+XR5z/ERWIkFR\nuK2cLpflhGv4zE5DkI/2Pp4EAsQirUPlbdelvEz6NPtJk6ws5gQgBorRPaDhZojz\ntcYkFzRv3gkNHCMCMEAPEgU1OdUqslJVwi9P+/cxe9Piwwd9WWTu7mg6OB0cjhPI\ntYzhAgMBAAGjIzAhMA4GA1UdDwEB/wQEAwIAATAPBgNVHRMBAf8EBTADAQH/MA0G\nCSqGSIb3DQEBCwUAA4ICAQAjGgAz92xGNjbcIxsn2B/URYTBcsKd9RcgmzB3kDWq\nEKUV3KbgAItq4c2WB9bc0IG1Icp9bYOXZy1ldPoGib4edMUZuOU4xUAFVCrALGbk\ng8ldoEuIiSGAjQDuvWxl6XK8/FcBK93tR591zuJHS2KXspnV3FWi1tE8lr2zEd+G\nwuFzm0/uAyg+A+SEZVGwSBSH0fMWcCEk+yGyb4zmM3VW8D5zQvbialiqdmycZWoi\nC7Ldto5dBeFCCL7ndh1U0//UqaDmRCLazSeU6wCilWT4RvejBwNcojIYd0wk9keS\n8z92wpKj5Hv+OPn1r4fAmMnc3ObwtkVnka+QvuhKZOXmNInJSqdsZFToS6TaQOO6\n/W/urXYlcILJPlbTMlpjzxYVCi93yMcSrrdZ3MADlPhgtN+clVIRSQ/7eIDkh7j9\n9C+Dsz9nKa7FBSngDheJEEPcG2jNeRvO9kM2hgkMfcNdmTZUNyE19p1bdnTFoWCs\nq22fGvXZi6kkZTMDcSYDBZ8OkWK20GuZAs1mxrz9HfMdZobH7yNOj7Oj+0bNf5Ef\ntN6We84bWM+Xh7wlZxXPHpos5JDC5PV1Kmbwf3riLtTVe2W7hy+oKULS+WO59KJz\niKzeAM8CuUQixJtSmrNjp1nAsSR6/BZXWRvmZShksQ4kwFm/PlsWLEKgtzxtP0tN\nfg==\n-----END CERTIFICATE-----`;\n\nexport const certificates = {\n  dev,\n  prod,\n};\n","import React from \"react\";\n\nimport { Row, Col, Form as BsForm, Button } from \"react-bootstrap\";\nimport { useForm } from \"react-hook-form\";\nimport { useQueryParams } from \"./useQueryParams\";\n\nconst RadioChoice = React.forwardRef(({ name, value, ...props }, ref) => (\n  <BsForm.Check\n    inline\n    ref={ref}\n    name={name}\n    id={`${name}-${value}`}\n    label={value}\n    type=\"radio\"\n    value={value}\n    {...props}\n  />\n));\n\nconst isValidQueryParamsKey = (key) =>\n  [\"namespace\", \"scope\", \"cluster\", \"name\"].includes(key);\n\nconst removeInvalidKeys = (keyValidator) => (object) =>\n  Object.keys(object)\n    .filter(keyValidator)\n    .reduce(\n      (acc, key) => ({\n        ...acc,\n        [key]: object[key],\n      }),\n      {}\n    );\n\nconst keepValidQueryParamKeys = removeInvalidKeys(isValidQueryParamsKey);\n\nexport const Form = ({ onSubmit, initialFormData }) => {\n  const [queryParamsData, setQueryParamsData] = useQueryParams();\n\n  const queryParams = keepValidQueryParamKeys(queryParamsData);\n\n  const defaultValues = {\n    ...initialFormData,\n    ...queryParams,\n    scope: queryParams.cluster === \"prod\" ? \"strict\" : \"cluster\",\n  };\n\n  const { register, handleSubmit, watch, setValue, trigger, getValues } =\n    useForm({\n      mode: \"onChange\",\n      defaultValues,\n    });\n\n  const _onSubmit = (data) => {\n    setQueryParamsData(keepValidQueryParamKeys(data));\n    onSubmit(data);\n    //console.log(\"submit\", data);\n  };\n\n  const cluster = watch(\"cluster\");\n  const scope = watch(\"scope\");\n  const value = watch(\"value\");\n\n  React.useEffect(() => {\n    const subscription = watch(\n      (\"value\",\n      ({ name, type }) => {\n        const values = getValues();\n        _onSubmit(values);\n      })\n    );\n    return () => subscription.unsubscribe();\n  }, [watch]);\n\n  React.useEffect(() => {\n    const subscription = watch(\n      (\"cluster\",\n      ({ name, type }) => {\n        const values = getValues();\n        _onSubmit(values);\n      })\n    );\n    return () => subscription.unsubscribe();\n  }, [watch]);\n\n  return (\n    <BsForm onSubmit={handleSubmit(_onSubmit)}>\n      <Row>\n        <Col xs={12} md={6}>\n          <Row>\n            <Col sm=\"3\">\n              <BsForm.Label>Cluster</BsForm.Label>\n            </Col>\n            <Col sm=\"9\">\n              <RadioChoice\n                name=\"cluster\"\n                value=\"dev\"\n                label=\"dev / preprod\"\n                {...register(\"cluster\")}\n                onChange={(e) => {\n                  setValue(\"cluster\", e.target.value);\n                  setValue(\"scope\", \"cluster\");\n                  setValue(\"namespace\", undefined);\n                  setValue(\"name\", undefined);\n                  trigger();\n                }}\n              />\n              <RadioChoice\n                name=\"cluster\"\n                value=\"prod\"\n                {...register(\"cluster\")}\n                onChange={(e) => {\n                  setValue(\"cluster\", e.target.value);\n                  setValue(\"scope\", \"strict\");\n                  trigger();\n                }}\n              />\n            </Col>\n          </Row>\n        </Col>\n        <Col style={{ display: \"none\" }}>\n          <Row>\n            <Col xs={12} sm={3}>\n              <BsForm.Label>Scope</BsForm.Label>\n            </Col>\n            <Col sm={9}>\n              <RadioChoice\n                name=\"scope\"\n                value=\"cluster\"\n                disabled={cluster === \"prod\"}\n                {...register(\"scope\")}\n                onChange={(e) => {\n                  setValue(\"scope\", e.target.value);\n                  trigger();\n                }}\n              />\n              <RadioChoice\n                name=\"scope\"\n                value=\"namespace\"\n                disabled={cluster === \"prod\"}\n                {...register(\"scope\")}\n                onChange={(e) => {\n                  setValue(\"scope\", e.target.value);\n                  trigger();\n                }}\n              />\n              <RadioChoice\n                name=\"scope\"\n                value=\"strict\"\n                {...register(\"scope\")}\n                onChange={(e) => {\n                  setValue(\"scope\", e.target.value);\n                  trigger();\n                }}\n              />\n            </Col>\n          </Row>\n        </Col>\n      </Row>\n      {(scope === \"namespace\" || scope === \"strict\") && (\n        <BsForm.Group as={Row}>\n          <BsForm.Label column>Namespace</BsForm.Label>\n          <Col sm=\"9\">\n            <BsForm.Control\n              name=\"namespace\"\n              {...register(\"namespace\", { required: true })}\n              required\n              type=\"text\"\n              placeholder=\"K8s Namespace\"\n            />\n          </Col>\n        </BsForm.Group>\n      )}\n      {scope === \"strict\" && (\n        <BsForm.Group as={Row}>\n          <BsForm.Label column>Secret name</BsForm.Label>\n          <Col sm=\"9\">\n            <BsForm.Control\n              name=\"name\"\n              {...register(\"name\", { required: true })}\n              type=\"text\"\n              placeholder=\"K8s secret name\"\n            />\n          </Col>\n        </BsForm.Group>\n      )}\n      <BsForm.Group>\n        <BsForm.Control\n          as=\"textarea\"\n          name=\"value\"\n          id=\"value\"\n          style={{ marginTop: 10 }}\n          rows={8}\n          {...register(\"value\", { required: true, value })}\n          placeholder={`MY_TOKEN=SomeSuperSecretToken\nMY_PASSWORD=SomeSuperSecretPassword`}\n        />\n      </BsForm.Group>\n    </BsForm>\n  );\n};\n","import { parse, stringify } from \"query-string\";\nimport { useCallback, useState } from \"react\";\n\nexport const useQueryParams = () => {\n  const urlParams = parse(window.location.search);\n\n  const [innerData, setInnerData] = useState(urlParams);\n\n  const setData = useCallback(\n    (data) => {\n      // dont reload page\n      window.history.replaceState(\n        {},\n        window.title,\n        document.location.href.split(\"?\")[0] + \"?\" + stringify(data)\n      );\n      setInnerData(data);\n    },\n    [setInnerData]\n  );\n\n  return [innerData, setData];\n};\n","import { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}